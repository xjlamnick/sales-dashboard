name: Синхронізація продажів з Google Sheets

on:
  schedule:
    - cron: '0 */3 * * *'     # кожні 3 години (можна змінити)
  workflow_dispatch:          # кнопка «Run workflow» вручну

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Завантажити свіжий CSV
        uses: githubocto/flat@v3
        with:
          http_url: https://docs.google.com/spreadsheets/d/e/2PACX-1v.../pub?output=csv   # ← встав своє посилання
          downloaded_filename: sales.csv     # ім'я файлу в репозиторії

      # Якщо твоєму сайту потрібен JSON замість CSV — розкоментуй цей блок:
      # - name: Конвертувати CSV → JSON
      #   run: |
      #     npm install csvtojson
      #     npx csvtojson sales.csv > sales.json
      #     git add sales.json

      - name: Запушити зміни (якщо є)
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add sales.csv
          git commit -m "Автооновлення продажів з Google Sheets" || exit 0
          git push
